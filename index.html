<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="img/logo.png" type="image/png">


<title>MovieDrift</title>


<style> 
:root { --bg:#000; --card-bg:#0a0a0a; --accent:#00ff66; --text:#ddd; --muted:#888; }
body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color: var(--text);}
header { display:flex; justify-content:space-between; align-items:center; background:#111; padding:10px 20px; flex-wrap:wrap;}
.logo { font-size:24px; font-weight:bold; color: var(--accent);}
.controls { display:flex; gap:10px; flex-wrap:wrap;}
input, select, button, textarea { padding:6px 10px; border:1px solid var(--accent); border-radius:4px; background: var(--card-bg); color: var(--text);}
button { cursor:pointer; font-weight:bold;} 
button:hover { background:#003300;}

main { padding:20px;}
.grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap:20px;}
.card { background: var(--card-bg); border:1px solid rgba(0,255,102,0.15); border-radius:8px; overflow:hidden; display:flex; flex-direction:column; transition: transform 0.2s;}
.card:hover { transform: scale(1.05);}
.poster { width:100%; aspect-ratio: 2/3; object-fit:cover;}
.card-body { padding:10px; flex-grow:1; display:flex; flex-direction:column; justify-content:space-between;}
.movie-title { font-size:16px; font-weight:bold; color:var(--accent); margin:0;}
.meta { font-size:13px; color:var(--muted); margin:4px 0;}
.rating { font-size:13px; color:#ffcc00; margin:2px 0;}
.card-actions { display:flex; gap:5px; flex-wrap:wrap;}
.btn { flex:1; text-align:center;}

/* ---------------- FIXED MODAL (TV + BIG SCREENS SAFE) ---------------- */
.modal { 
  display:none; 
  position:fixed; 
  inset:0; 
  background:rgba(0,0,0,0.92); 
  justify-content:center; 
  align-items:center;              /* center on all screens */
  z-index:1000; 
  overflow-y:auto;                 /* allow full scroll on TVs */
  padding:40px 20px;               /* space for top & bottom */
}

/* SAFE modal container for TVs */
.modal-content { 
  background:var(--card-bg); 
  width:90%;
  max-width:1000px;

  /* Prevent TV clipping */
  max-height:90vh;                 /* always fits inside ANY TV */
  overflow-y:auto;                 /* internal scroll for long content */

  border-radius:10px; 
  padding:20px; 
  position:relative;
}

/* Responsive Player */
.modal-content iframe,
.modal-content video { 
  width:100%; 
  height:auto;
  
  /* keep player fully visible on TVs */
  max-height:45vh;                 /* prevents overflow even on 720p TVs */

  border-radius:6px; 
  margin-bottom:15px;
}

/* Close button */
.close { 
  position:absolute; 
  top:10px; 
  right:15px; 
  cursor:pointer; 
  color:var(--accent); 
  font-size:26px;
}

/* ---------------- WATCHLIST ---------------- */
#watchlistModal h2 { color:var(--accent); margin-bottom:15px;}
#watchlistModal .movie-list { display:grid; grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); gap:15px;}
.watchlist-card { background:#111; border-radius:8px; padding:10px; text-align:center; transition:transform 0.2s;}
.watchlist-card:hover { transform:scale(1.05); background:#181818;}
.watchlist-card img { width:100%; aspect-ratio: 2/3; object-fit:cover; margin-bottom:6px;}
.remove-btn { margin-top:6px; padding:4px 8px; border:none; border-radius:4px; background:#e63946; color:white; cursor:pointer; font-size:0.8rem;}
.remove-btn:hover { background:#c82333;}

.episode-list { margin-top:10px;}
.episode-list button { margin:2px; font-size:0.8rem;}

/* ----- THEMES ----- */
.theme-dark { --bg:#000; --card-bg:#0a0a0a; --accent:#00ff66; --text:#ddd; --muted:#888; }
.theme-white { --bg:#ffffff; --card-bg:#f2f2f2; --accent:#0066ff; --text:#000; --muted:#666; }
.theme-pink { --bg:#ffebf0; --card-bg:#ffd6e3; --accent:#ff2f8a; --text:#5a0032; --muted:#a64a6b; }
.theme-blue { --bg:#001122; --card-bg:#0a1a33; --accent:#00ccff; --text:#d0eaff; --muted:#88aacc; }
.theme-gold { --bg:#0d0c07; --card-bg:#1a1a10; --accent:#ffd700; --text:#fff4c2; --muted:#aa9955; }
.theme-purple { --bg:#120018; --card-bg:#25002f; --accent:#d800ff; --text:#f9d9ff; --muted:#b76cd8; }

/* --- Phone layout: 2 cards per row --- */
@media (max-width: 600px) {
  .grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }
}

.wa-small-btn {
  display:inline-flex;
  align-items:center;
  gap:6px;
  background:#25D366;
  color:#000;
  padding:6px 10px;
  border-radius:20px;
  font-size:13px;
  font-weight:600;
  text-decoration:none;
  border:1px solid #128C7E;
  transition:0.2s ease-in-out;
}
.wa-small-btn:hover {
  background:#1ebe5d;
  transform:scale(1.05);
}
.wa-small-btn svg { display:block; }

/* ============================================================
   NETFLIX TV REMOTE FOCUS STYLE (NEW)
   ============================================================ */
.tv-focus {
  outline:4px solid var(--accent);
  outline-offset:4px;
  transform:scale(1.08) !important;
  z-index:5 !important;
  transition:0.15s ease-in-out;
}
</style>


</head>
<body>
  
<header>
  <div class="logo">MovieDrift</div>
  <select id="themeSelector">
  <option value="dark">Dark Green (Default)</option>
  <option value="white">White Mode</option>
  <option value="pink">Soft Pink</option>
  <option value="blue">Blue Neon</option>
  <option value="gold">Gold Premium</option>
  <option value="purple">Purple Night</option>
</select>
 <a href="https://chat.whatsapp.com/EzXluKjsqMoCgJPYc03gQx?mode=hqrt1"
   target="_blank"
   class="wa-small-btn">
   <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
     <path d="M13.601 2.326A7.86 7.86 0 0 0 8.043 0C3.733 0 .254 3.478.254 7.787c0 1.373.36 2.712 1.04 3.895L0 16l4.486-1.17a7.75 7.75 0 0 0 3.556.903h.004c4.31 0 7.789-3.478 7.789-7.787a7.72 7.72 0 0 0-2.234-5.62zM8.046 14.4h-.003a6.45 6.45 0 0 1-3.283-.896l-.235-.14-2.662.694.71-2.59-.153-.266a6.47 6.47 0 0 1-.98-3.45c0-3.568 2.907-6.474 6.48-6.474a6.43 6.43 0 0 1 4.58 1.897 6.42 6.42 0 0 1 1.894 4.577c-.003 3.57-2.91 6.476-6.468 6.476zm3.76-4.842c-.206-.103-1.226-.602-1.416-.671-.19-.07-.33-.103-.47.103-.14.206-.54.671-.662.81-.123.14-.243.155-.45.052-.206-.103-.87-.32-1.656-1.02-.612-.546-1.024-1.22-1.146-1.426-.123-.206-.013-.317.09-.42.093-.093.206-.24.31-.36.103-.12.137-.206.206-.343.07-.137.035-.258-.017-.36-.052-.103-.47-1.127-.643-1.544-.17-.41-.343-.354-.47-.354a9.48 9.48 0 0 0-.41-.007c-.137 0-.36.052-.55.258-.19.206-.72.703-.72 1.71s.737 1.978.84 2.115c.103.137 1.45 2.213 3.516 3.103.492.212.875.339 1.174.434.492.157.94.135 1.293.082.395-.058 1.226-.5 1.4-.982.172-.482.172-.89.12-.982-.052-.093-.19-.155-.395-.258z"/>
   </svg>
   suggestions
</a>

  <div class="controls">
    <input id="search" type="search" placeholder="Search movies...">
    <select id="typeFilter"><option value="">All types</option><option value="Movie">Movie</option><option value="Series">Series</option><option value="Animation">Animation</option></select>
    <select id="genreFilter"><option value="">All genres</option></select>
    <select id="yearFilter"><option value="">All years</option></select>
    <button id="watchlistToggle">Watchlist (0)</button>
  </div>
</header>

<main><div id="grid" class="grid"></div></main>

<div class="modal" id="movieModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('movieModal')">&times;</span>

    <div class="modal-scroll-area">
      <h2 id="modalTitle"></h2>
      <p id="modalYear"></p>
      <p id="modalGenres"></p>
      <p class="rating" id="modalRating"></p>
      <div id="modalPlayer"></div>
      <div class="episode-list" id="episodeList"></div>
      <p id="modalDesc"></p>
      <button id="modalAddToList" class="btn">âž• Add to Watchlist</button>
    </div>

  </div>
</div>


<div class="modal" id="watchlistModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('watchlistModal')">&times;</span>
    <h2>ðŸ“º Your Watchlist</h2>
    <div class="movie-list" id="watchlistContainer"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// ---------------- FIREBASE CONFIG ----------------
const firebaseConfig = {
  apiKey: "AIzaSyD2gkLs17Oa_dxIGu1FpOaDKAvGZwj_EFA",
  authDomain: "gamers-65b44.firebaseapp.com",
  projectId: "gamers-65b44",
  storageBucket: "gamers-65b44.firebasestorage.app",
  messagingSenderId: "97331968745",
  appId: "1:97331968745:web:a93ff0bd2c383800dcce78",
  measurementId: "G-JPPCZ3M4G2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let movies = [];
let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
const genreFilter = document.getElementById("genreFilter");
const yearFilter = document.getElementById("yearFilter");

// ---------------- LOAD MOVIES REALTIME (NEWEST YEAR FIRST) ----------------
onSnapshot(collection(db, "movies"), async snapshot => {
  movies = snapshot.docs
    .map(d => {
      const data = d.data();
      const createdAt = data.createdAt?.seconds
        ? data.createdAt.seconds * 1000
        : data.createdAt || 0;
      const year = parseInt(data.year) || 0;
      return { id: d.id, ...data, createdAt, year, episodes: [] }; // add episodes array
    })
    .sort((a, b) => {
      if (b.year !== a.year) return b.year - a.year;
      return b.createdAt - a.createdAt;
    });

  // ---------------- REAL-TIME EPISODES FETCH ----------------
  movies.forEach(m => {
    if (m.type === "Series") {
      const episodesColl = collection(db, "movies", m.id, "episodes");
      const q = query(episodesColl, orderBy("epNumber", "asc"));
      onSnapshot(q, snapshot => {
        m.episodes = snapshot.docs.map(d => ({
          id: d.id,
          ep: d.data().epNumber,
          ...d.data()
        })).sort((a,b) => (a.ep||0)-(b.ep||0));
        renderMovies(); // update UI when episodes change
      });
    }
  });

  populateFilters();
  renderMovies();
});

// ---------------- FILTER OPTIONS ----------------
function populateFilters() {
  const genreSet = new Set(), yearSet = new Set();
  movies.forEach(m => {
    if (m.genres) m.genres.forEach(g => genreSet.add(g));
    yearSet.add(m.year);
  });
  genreFilter.innerHTML = '<option value="">All genres</option>';
  yearFilter.innerHTML = '<option value="">All years</option>';
  genreSet.forEach(g => genreFilter.innerHTML += `<option value="${g}">${g}</option>`);
  Array.from(yearSet).sort((a, b) => b - a).forEach(y => yearFilter.innerHTML += `<option value="${y}">${y}</option>`);
}

// ---------------- RENDER MOVIES ----------------
function renderMovies() {
  const grid = document.getElementById("grid");
  const searchText = document.getElementById("search").value.toLowerCase();
  const selectedGenre = genreFilter.value;
  const selectedYear = yearFilter.value;
  const selectedType = document.getElementById("typeFilter").value;
  grid.innerHTML = "";

  const filtered = movies.filter(m => {
    const matchesSearch = m.title.toLowerCase().includes(searchText);
    const matchesGenre = !selectedGenre || (m.genres && m.genres.includes(selectedGenre));
    const matchesYear = !selectedYear || m.year == selectedYear;
    const matchesType = !selectedType || m.type === selectedType || !m.type;
    return matchesSearch && matchesGenre && matchesYear && matchesType;
  });

  filtered.forEach((m, index) => {
    const ratingText = m.rating ? `${m.rating.toFixed(1)} / 10 (${Math.round(m.rating * 10)}%)` : "";
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img class="poster" src="${m.poster}" alt="${m.title}">
      <div class="card-body">
        <h3 class="movie-title">${m.title}</h3>
        <div class="meta">${m.year} Â· ${(m.genres || []).join(", ")}</div>
        <div class="rating">${ratingText}</div>
        <div class="card-actions">
          <button class="btn" onclick="viewDetailsByFiltered(${index})">Details</button>
          <button class="btn" onclick="addToWatchlistByFiltered(${index})">Add to List</button>
          <button class="btn" onclick="watchTrailerByFiltered(${index})">Watch</button>
        </div>
      </div>`;
    grid.appendChild(card);
  });
  window.currentFiltered = filtered;
}

// ---------------- MODAL & YOUTUBE ----------------
function convertYouTubeLink(url) {
  try {
    if (url.includes("youtube.com/watch?v="))
      return `https://www.youtube.com/embed/${url.split("v=")[1].split("&")[0]}?rel=0`;
    if (url.includes("youtu.be/"))
      return `https://www.youtube.com/embed/${url.split("youtu.be/")[1].split("?")[0]}?rel=0`;
    return url;
  } catch {
    return url;
  }
}

function isDownloadable(url) {
  return /\.(mp4|mkv|mov|wmv|avi|flv|webm)$/i.test(url);
}

// ---------------- VIEW DETAILS ----------------
window.viewDetailsByFiltered = function (index) {
  const m = window.currentFiltered[index];
  const player = document.getElementById("modalPlayer");
  const episodeList = document.getElementById("episodeList");

  player.innerHTML = "";
  episodeList.innerHTML = "";

  if (m.trailer) {
    player.innerHTML += `
      <h4>Trailer</h4>
      <iframe src="${convertYouTubeLink(m.trailer)}" frameborder="0" allowfullscreen style="width:100%;height:400px;"></iframe>
    `;
  }

  if (m.fileUrl) {
    const direct = isDownloadable(m.fileUrl);
    if (direct) {
      player.innerHTML += `<h4>Movie</h4><video controls src="${m.fileUrl}" style="width:100%;max-height:500px;"></video>
        <a href="${m.fileUrl}" download style="display:inline-block;margin-top:10px;background:#00ff66;
        padding:10px 15px;border-radius:6px;color:black;font-weight:bold;text-decoration:none;">â¬‡ Download</a>`;
    } else {
      player.innerHTML += `<h4>Movie</h4><iframe src="${m.fileUrl}" frameborder="0" allowfullscreen style="width:100%;height:500px;"></iframe>`;
    }
  }

  // ---------------- SHOW EPISODES (REAL-TIME) ----------------
  if (m.episodes && Array.isArray(m.episodes) && m.episodes.length > 0) {
    episodeList.innerHTML = `<h4>Episodes</h4>`;
    m.episodes.forEach(ep => {
      const playable = isDownloadable(ep.fileUrl || ep.url);
      const epUrl = ep.fileUrl || ep.url;
      episodeList.innerHTML += `
        <div style="border:1px solid #333;padding:10px;margin-top:8px;border-radius:6px;">
          <strong>Episode ${ep.ep}: ${ep.title || ""}</strong><br>
          ${ep.description ? `<small>${ep.description}</small><br>` : ""}
          ${playable ? `<video controls src="${epUrl}" style="width:100%;margin-top:8px;"></video>
          <a href="${epUrl}" download style="display:inline-block;margin-top:8px;background:#00ff66;
             padding:8px 12px;border-radius:6px;color:black;font-weight:bold;text-decoration:none;">â¬‡ Download Episode</a>` 
          : `<iframe src="${epUrl}" frameborder="0" allowfullscreen style="width:100%;height:400px;margin-top:8px;"></iframe>`}
        </div>
      `;
    });
  }

  document.getElementById("modalTitle").innerText = m.title;
  document.getElementById("modalYear").innerText = "Year: " + m.year;
  document.getElementById("modalGenres").innerText = "Genres: " + (m.genres || []).join(", ");
  document.getElementById("modalRating").innerText = m.rating
    ? `${m.rating.toFixed(1)} / 10 (${Math.round(m.rating * 10)}%)`
    : "";
  document.getElementById("modalDesc").innerText = m.description || "";
  document.getElementById("movieModal").style.display = "flex";

  document.getElementById("modalAddToList").onclick = () => addToWatchlistByFiltered(index);
};

// ---------------- WATCHLIST ----------------
window.addToWatchlistByFiltered = function (index) {
  const m = window.currentFiltered[index];
  if (!watchlist.find(x => x.title === m.title)) {
    watchlist.push(m);
    saveWatchlist();
    alert("âœ… Added to Watchlist");
  } else alert("âš ï¸ Already in Watchlist");
  updateWatchlistButton();
};
function saveWatchlist() { localStorage.setItem("watchlist", JSON.stringify(watchlist)); }
function updateWatchlistButton() { document.getElementById("watchlistToggle").textContent = `Watchlist (${watchlist.length})`; }

window.watchTrailerByFiltered = index => viewDetailsByFiltered(index);
window.closeModal = id => (document.getElementById(id).style.display = "none");

document.getElementById("watchlistToggle").onclick = function () {
  const container = document.getElementById("watchlistContainer");
  container.innerHTML = watchlist.length
    ? watchlist.map((m, i) =>
        `<div class='watchlist-card'>
          <img src='${m.poster}'><h4>${m.title}</h4><p>${m.year}</p>
          <button class='remove-btn' onclick='removeFromWatchlist(${i})'>Remove</button>
        </div>`).join("")
    : "<p>No movies yet.</p>";
  document.getElementById("watchlistModal").style.display = "flex";
};
window.removeFromWatchlist = i => { watchlist.splice(i, 1); saveWatchlist(); updateWatchlistButton(); document.getElementById("watchlistToggle").click(); };

// ---------------- EVENT LISTENERS ----------------
document.getElementById("search").addEventListener("input", renderMovies);
document.getElementById("genreFilter").addEventListener("change", renderMovies);
document.getElementById("yearFilter").addEventListener("change", renderMovies);
document.getElementById("typeFilter").addEventListener("change", renderMovies);

updateWatchlistButton();

// ---------------- THEME SYSTEM ----------------
const themeSelector = document.getElementById("themeSelector");
const savedTheme = localStorage.getItem("theme") || "dark";
document.body.classList.add("theme-" + savedTheme);
themeSelector.value = savedTheme;
themeSelector.onchange = () => {
  const theme = themeSelector.value;
  document.body.classList.remove("theme-dark", "theme-white", "theme-pink", "theme-blue", "theme-gold", "theme-purple");
  document.body.classList.add("theme-" + theme);
  localStorage.setItem("theme", theme);
};
  // ---------------- BACK BUTTON HANDLING ----------------
(function() {
  const modalIds = ["movieModal", "watchlistModal"];
  let openModal = null;

  // Listen for modal openings
  const observer = new MutationObserver(() => {
    modalIds.forEach(id => {
      const modal = document.getElementById(id);
      if (modal.style.display === "flex") {
        openModal = modal;
        // Push state only if a modal opens
        history.pushState({ modalOpen: true, modalId: id }, "");
      }
    });
  });
  observer.observe(document.body, { attributes: true, subtree: true, attributeFilter: ["style"] });

  // Handle back button
  window.addEventListener("popstate", function(event) {
    if (event.state && event.state.modalOpen && event.state.modalId) {
      const modal = document.getElementById(event.state.modalId);
      if (modal) {
        modal.style.display = "none";
        openModal = null;
      }
    } else if (openModal) {
      // Close currently open modal
      openModal.style.display = "none";
      openModal = null;
      // Push a new state so user can go back to previous page if desired
      history.pushState({}, "");
    }
    // If no modal is open, back button works normally
  });
})();

</script>

<script>
// =========================
// NETFLIX-STYLE TV NAVIGATION
// =========================

// Get all movie cards
let cards = [];
let focusedIndex = 0;

// Add focus highlight class
const focusClass = "tv-focus";

// Add special focus glow style
const style = document.createElement("style");
style.innerHTML = `
.${focusClass} {
  outline:4px solid var(--accent);
  outline-offset:4px;
  transform:scale(1.08) !important;
  z-index:5 !important;
}
`;
document.head.appendChild(style);

// Run once page loads
window.addEventListener("load", () => {
  cards = Array.from(document.querySelectorAll(".card"));
  if(cards.length > 0) {
    cards[0].classList.add(focusClass);
    focusedIndex = 0;
  }
});

// ----------------------
// CHANGE FOCUS HANDLER
// ----------------------
function moveFocus(newIndex) {
  if(!cards.length) return;
  if(newIndex < 0 || newIndex >= cards.length) return;

  cards[focusedIndex].classList.remove(focusClass);
  focusedIndex = newIndex;
  cards[focusedIndex].classList.add(focusClass);

  // scroll card into view on TVs
  cards[focusedIndex].scrollIntoView({
    behavior:"smooth",
    block:"nearest",
    inline:"center"
  });
}

// ----------------------
// GRID POSITION CALCULATOR
// ----------------------
function getCardsPerRow() {
  const firstCard = cards[0];
  if(!firstCard) return 1;

  const cardWidth = firstCard.offsetWidth + 20; // gap included
  return Math.floor(window.innerWidth / cardWidth);
}

// ----------------------
// REMOTE KEY EVENTS
// ----------------------
document.addEventListener("keydown", (e) => {
  const rows = getCardsPerRow();

  if(e.key === "ArrowRight") {
    moveFocus(focusedIndex + 1);
  }

  else if(e.key === "ArrowLeft") {
    moveFocus(focusedIndex - 1);
  }

  else if(e.key === "ArrowDown") {
    moveFocus(focusedIndex + rows);
  }

  else if(e.key === "ArrowUp") {
    moveFocus(focusedIndex - rows);
  }

  else if(e.key === "Enter") {
    // simulate pressing WATCH button
    const btn = cards[focusedIndex].querySelector("button");
    if(btn) btn.click();
  }

  else if(e.key === "Backspace" || e.key === "Escape") {
    const modal = document.getElementById("playerModal");
    if(modal && modal.style.display === "flex") {
      modal.style.display = "none";
    }
  }
});
</script>


</body>
</html>





















<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/logo.png" type="image/png">
  <title>MovieDrift</title>
  <style>
    :root {
      --bg:#000;
      --card-bg:#0a0a0a;
      --accent:#00ff66;
      --text:#ddd;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
    body{background:var(--bg);color:var(--text)}
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#111}
    header h1{color:var(--accent);font-size:1.5rem}
    header nav button{background:var(--accent);color:#000;border:none;padding:.5rem 1rem;margin-left:.5rem;cursor:pointer;border-radius:5px}
    .container{padding:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1rem}
    .movie-card{background:var(--card-bg);padding:.5rem;border-radius:8px;text-align:center}
    .movie-card img{width:100%;border-radius:5px}
    .btn{background:var(--accent);border:none;padding:.5rem;margin-top:.5rem;width:100%;cursor:pointer;border-radius:5px;color:#000}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);justify-content:center;align-items:center;z-index:1000}
    .modal-content{background:#111;padding:1rem;border-radius:8px;width:90%;max-width:600px;color:var(--text)}
    .close{float:right;font-size:1.5rem;cursor:pointer}
    #watchlistCount{background:red;color:#fff;border-radius:50%;padding:2px 6px;font-size:.8rem;vertical-align:top;margin-left:4px}
    .watchlist-card{background:#222;padding:.5rem;border-radius:6px;margin:.5rem 0;display:flex;gap:.5rem;align-items:center}
    .watchlist-card img{width:60px;height:90px;object-fit:cover;border-radius:5px}
    .remove-btn{background:red;color:#fff;border:none;padding:.3rem .6rem;cursor:pointer;border-radius:4px}
    input[type=password]{width:100%;padding:.5rem;margin:.5rem 0;border-radius:5px;border:1px solid #333;background:#222;color:#fff}
  </style>
</head>
<body>
<header>
  <h1>üé¨ MovieDrift</h1>
  <nav>
    <button id="watchlistToggle">üì∫ Watchlist <span id="watchlistCount">0</span></button>
    <button id="adminLogin">üîë Admin</button>
  </nav>
</header>

<div class="container" id="movieContainer"></div>

<!-- Movie Modal -->
<div class="modal" id="movieModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('movieModal')">&times;</span>
    <div id="movieDetails"></div>
  </div>
</div>

<!-- Watchlist Modal -->
<div class="modal" id="watchlistModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('watchlistModal')">&times;</span>
    <h2>üì∫ My Watchlist</h2>
    <div id="watchlistContainer"></div>
  </div>
</div>

<!-- Admin Login Modal -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('loginModal')">&times;</span>
    <h2>üîë Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button onclick="checkAdminLogin()">Login</button>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" style="display:none;padding:1rem;background:#111;">
  <h2>üé• Admin Panel</h2>
  <div id="adminMovies"></div>
</div>

<script>
let movies = [];
let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];

document.addEventListener("DOMContentLoaded", () => {
  loadMovies();
  updateWatchlistCount();
  document.getElementById("watchlistToggle").addEventListener("click", showWatchlist);
});

// Fetch movies
function loadMovies() {
  fetch("movies.json")
    .then(res => res.json())
    .then(data => {
      movies = data;
      renderMovies();
    });
}

// Render movies
function renderMovies() {
  const container = document.getElementById("movieContainer");
  container.innerHTML = "";
  movies.forEach((movie, index) => {
    const div = document.createElement("div");
    div.className = "movie-card";
    div.innerHTML = `
      <img src="${movie.poster}" alt="${movie.title}">
      <h3>${movie.title}</h3>
      <p>${movie.year}</p>
      <button class="btn" onclick="openMovie(${index})">‚ñ∂Ô∏è Details</button>
      <button class="btn" onclick="addToWatchlist(${index})">‚ûï Watchlist</button>
    `;
    container.appendChild(div);
  });
}

// Movie details modal
function openMovie(index) {
  const movie = movies[index];
  document.getElementById("movieDetails").innerHTML = `
    <h2>${movie.title} (${movie.year})</h2>
    <p>${movie.genres.join(", ")}</p>
    <video width="100%" controls>
      <source src="${movie.source}" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  `;
  document.getElementById("movieModal").style.display = "flex";
}

// Watchlist functions
function addToWatchlist(index) {
  if (!watchlist.find(m => m.title === movies[index].title)) {
    watchlist.push(movies[index]);
    saveWatchlist();
    updateWatchlistCount();
    alert("Added to Watchlist");
  } else {
    alert("Already in Watchlist");
  }
}

function showWatchlist() {
  const container = document.getElementById("watchlistContainer");
  container.innerHTML = "";
  if (watchlist.length === 0) {
    container.innerHTML = "<p>No movies yet.</p>";
  } else {
    watchlist.forEach((m, index) => {
      const div = document.createElement("div");
      div.className = "watchlist-card";
      div.innerHTML = `
        <img src="${m.poster}" alt="${m.title}">
        <h4>${m.title}</h4>
        <p>${m.year} ¬∑ ${m.genres.join(", ")}</p>
        <button class="remove-btn" onclick="removeFromWatchlist(${index})">Remove</button>
      `;
      container.appendChild(div);
    });
  }
  document.getElementById("watchlistModal").style.display = "flex";
}

function removeFromWatchlist(index) {
  watchlist.splice(index, 1);
  saveWatchlist();
  updateWatchlistCount();
  showWatchlist();
}

function saveWatchlist() {
  localStorage.setItem("watchlist", JSON.stringify(watchlist));
}

function updateWatchlistCount() {
  document.getElementById("watchlistCount").textContent = watchlist.length;
}

// Admin login
document.getElementById("adminLogin").addEventListener("click", () => {
  document.getElementById("loginModal").style.display = "flex";
});

function checkAdminLogin() {
  const pwd = document.getElementById("adminPassword").value;
  if (pwd === "@Stone001") {
    document.getElementById("adminPanel").style.display = "block";
    renderAdminMovies();
    closeModal("loginModal");
    alert("Admin mode activated");
  } else {
    alert("Wrong password");
  }
}

// Admin panel render
function renderAdminMovies() {
  const container = document.getElementById("adminMovies");
  container.innerHTML = "";
  movies.forEach((movie, index) => {
    const div = document.createElement("div");
    div.innerHTML = `
      <strong>${movie.title}</strong>
      <button onclick="deleteMovie(${index})">üóëÔ∏è Delete</button>
    `;
    container.appendChild(div);
  });
}

// Delete movie
function deleteMovie(index) {
  if (confirm("Delete this movie?")) {
    movies.splice(index, 1);
    saveMoviesToFile();
    renderMovies();
    renderAdminMovies();
  }
}

// Save movies.json
function saveMoviesToFile() {
  fetch("save_movies.php", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(movies)
  });
}

// Close modal
function closeModal(id) {
  document.getElementById(id).style.display = "none";
}
</script>
</body>
</html>

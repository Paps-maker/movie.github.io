<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MovieDrift</title>
<style>
:root { --bg:#000; --card-bg:#0a0a0a; --accent:#00ff66; --text:#ddd; --muted:#888; }
body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color:var(--text); }
header { display:flex; justify-content:space-between; align-items:center; background:#111; padding:10px 20px; flex-wrap:wrap; }
.logo{font-size:24px; font-weight:bold; color:var(--accent);}
.controls{display:flex; gap:10px; flex-wrap:wrap;}
input,select,button,textarea{padding:6px 10px; border:1px solid var(--accent); border-radius:4px; background:var(--card-bg); color:var(--text);}
button{cursor:pointer; font-weight:bold;} button:hover{background:#003300;}
main{padding:20px;}
.grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:20px;}
.card{background:var(--card-bg); border:1px solid rgba(0,255,102,0.15); border-radius:8px; overflow:hidden; display:flex; flex-direction:column; transition:transform 0.2s;}
.card:hover{transform:scale(1.05);}
.poster{width:100%; height:300px; object-fit:cover;}
.card-body{padding:10px; flex-grow:1; display:flex; flex-direction:column; justify-content:space-between;}
.movie-title{font-size:16px; font-weight:bold; color:var(--accent); margin:0;}
.meta{font-size:13px; color:var(--muted); margin:4px 0;}
.card-actions{display:flex; gap:5px; flex-wrap:wrap;}
.btn{flex:1; text-align:center;}
.modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000; overflow-y:auto;}
.modal-content{background:var(--card-bg); max-width:900px; width:95%; max-height:90vh; overflow-y:auto; border-radius:8px; padding:20px; position:relative;}
.close{position:absolute; top:10px; right:15px; cursor:pointer; color:var(--accent); font-size:22px;}
iframe,video{width:100%; height:400px; border-radius:6px;}
#adminPanel{display:none; padding:20px; background:var(--card-bg); border-top:1px solid rgba(0,255,102,0.15);}
#adminPanel h3{color:var(--accent); margin-bottom:10px;}
.form-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:15px;}
label{font-size:13px; color:var(--muted); margin-bottom:3px; display:block;}
textarea{resize:vertical; min-height:80px;}
.submit-row{margin-top:15px; text-align:right;}
</style>
</head>
<body>

<header>
  <div class="logo">MovieDrift</div>
  <div class="controls">
    <input id="search" type="search" placeholder="Search movies...">
    <select id="genreFilter"><option value="">All genres</option></select>
    <select id="yearFilter"><option value="">All years</option></select>
    <button id="watchlistToggle">Watchlist (0)</button>
    <button id="adminLogin">Admin Login</button>
  </div>
</header>

<main><div id="grid" class="grid"></div></main>

<section id="adminPanel">
  <h3>‚ûï Add a Movie/Series</h3>
  <div class="form-grid">
    <div class="form-control"><label>Title</label><input id="movieTitle" type="text"></div>
    <div class="form-control"><label>Year</label><input id="movieYear" type="number"></div>
    <div class="form-control"><label>Genres (comma separated)</label><input id="movieGenres" type="text"></div>
    <div class="form-control"><label>Poster Image</label><input id="moviePosterFile" type="file" accept="image/*"></div>
    <div class="form-control"><label>Movie File (MP4)</label><input id="movieFile" type="file" accept="video/mp4"></div>
    <div class="form-control"><label>Trailer/Embed Link</label><input id="movieTrailer" type="url"></div>
    <div class="form-control" style="grid-column: span 2;"><label>Description</label><textarea id="movieDesc"></textarea></div>
  </div>
  <div class="submit-row"><button id="addMovieBtn">Add Movie/Series</button></div>
  <h3>üìã Manage Movies</h3>
  <div id="adminMovieList"></div>
</section>

<script>
let movies = [];
const grid=document.getElementById("grid");
const searchInput=document.getElementById("search");
const genreFilter=document.getElementById("genreFilter");
const yearFilter=document.getElementById("yearFilter");
const watchlistBtn=document.getElementById("watchlistToggle");

// ----- Fetch all movies from server -----
async function loadMovies(){
    const res = await fetch('save_movies.php');
    movies = await res.json();
    renderMovies();
    populateFilters();
}
loadMovies();

// ----- Render movies -----
function renderMovies(){
    grid.innerHTML="";
    const searchText=searchInput.value.toLowerCase();
    const genre=genreFilter.value;
    const year=yearFilter.value;
    const filtered = movies.filter(m=>{
        const matchesSearch = m.title.toLowerCase().includes(searchText) || m.description.toLowerCase().includes(searchText);
        const matchesGenre = genre ? m.genres.map(g=>g.toLowerCase()).includes(genre.toLowerCase()) : true;
        const matchesYear = year ? m.year==year : true;
        return matchesSearch && matchesGenre && matchesYear;
    });
    filtered.forEach((m,i)=>{
        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`
        <img class="poster" src="${m.poster}" alt="${m.title}">
        <div class="card-body">
          <h3 class="movie-title">${m.title}</h3>
          <div class="meta">${m.year} ¬∑ ${m.genres.join(", ")}</div>
        </div>`;
        grid.appendChild(card);
    });
}

// ----- Populate filters -----
function populateFilters(){
    const allGenres = new Set();
    movies.forEach(m=>m.genres.forEach(g=>allGenres.add(g)));
    genreFilter.innerHTML='<option value="">All genres</option>';
    allGenres.forEach(g=>{const opt=document.createElement("option"); opt.value=g; opt.innerText=g; genreFilter.appendChild(opt);});
    const allYears = [...new Set(movies.map(m=>m.year))].sort((a,b)=>b-a);
    yearFilter.innerHTML='<option value="">All years</option>';
    allYears.forEach(y=>{const opt=document.createElement("option"); opt.value=y; opt.innerText=y; yearFilter.appendChild(opt);});
}

// ----- Admin panel -----
document.getElementById("adminLogin").addEventListener("click",()=>{
    const pwd=prompt("Enter admin password:");
    if(pwd==="@Stone001"){
        document.getElementById("adminPanel").style.display="block";
        renderAdminMovies();
        alert("‚úÖ Admin mode activated!");
    } else alert("‚ùå Wrong password!");
});

// Add movie
document.getElementById("addMovieBtn").addEventListener("click", async ()=>{
    const formData = new FormData();
    formData.append('action','add');
    formData.append('title', document.getElementById("movieTitle").value.trim());
    formData.append('year', document.getElementById("movieYear").value.trim());
    formData.append('genres', document.getElementById("movieGenres").value.trim());
    formData.append('description', document.getElementById("movieDesc").value.trim());
    const poster = document.getElementById("moviePosterFile").files[0];
    if(poster) formData.append('poster', poster);
    const movieFile = document.getElementById("movieFile").files[0];
    if(movieFile) formData.append('movieFile', movieFile);
    const trailer = document.getElementById("movieTrailer").value.trim();
    if(trailer) formData.append('trailer', trailer);

    const res = await fetch('save_movies.php',{method:'POST',body:formData});
    const data = await res.json();
    if(data.success){ movies = data.movies; renderMovies(); populateFilters(); renderAdminMovies(); alert("‚úÖ Movie added!"); }
});

// Render admin movies
function renderAdminMovies(){
    const c=document.getElementById("adminMovieList");
    c.innerHTML="";
    if(movies.length===0){ c.innerHTML="<p>No movies added yet.</p>"; return; }
    movies.forEach((m,i)=>{
        const div=document.createElement("div");
        div.style.border="1px solid #333"; div.style.padding="10px"; div.style.margin="5px 0"; div.style.borderRadius="6px";
        div.innerHTML=`<strong>${m.title}</strong> (${m.year}) - ${m.genres.join(", ")}
        <div style="margin-top:6px;">
            <button onclick="deleteMovie(${i})" style="background:#e63946;color:white;">üóëÔ∏è Delete</button>
        </div>`;
        c.appendChild(div);
    });
}

// Delete movie
async function deleteMovie(i){
    if(!confirm(`‚ö†Ô∏è Are you sure you want to delete "${movies[i].title}"?`)) return;
    const formData=new FormData();
    formData.append('deleteIndex',i);
    const res=await fetch('save_movies.php',{method:'POST',body:formData});
    const data=await res.json();
    if(data.success){ movies=data.movies; renderMovies(); populateFilters(); renderAdminMovies(); alert("‚úÖ Movie deleted."); }
}

// Filters
searchInput.addEventListener("input", renderMovies);
genreFilter.addEventListener("change", renderMovies);
yearFilter.addEventListener("change", renderMovies);
</script>

</body>
</html>

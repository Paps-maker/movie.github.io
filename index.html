<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="img/logo.png" type="image/png">
<title>MovieDrift</title>
<style>
:root {
  --bg:#000; --card-bg:#0a0a0a; --accent:#00ff66; --text:#ddd; --muted:#888;
}
body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);}
header{display:flex;justify-content:space-between;align-items:center;background:#111;padding:10px 20px;flex-wrap:wrap;}
.logo{font-size:24px;font-weight:bold;color:var(--accent);}
.controls{display:flex;gap:10px;flex-wrap:wrap;}
input,select,button,textarea{padding:6px 10px;border:1px solid var(--accent);border-radius:4px;background:var(--card-bg);color:var(--text);}
button{cursor:pointer;font-weight:bold;}
button:hover{background:#003300;}
main{padding:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;}
.card{background:var(--card-bg);border:1px solid rgba(0,255,102,0.15);border-radius:8px;overflow:hidden;display:flex;flex-direction:column;transition:transform 0.2s;}
.card:hover{transform:scale(1.05);}
.poster{width:100%;height:300px;object-fit:cover;}
.card-body{padding:10px;flex-grow:1;display:flex;flex-direction:column;justify-content:space-between;}
.movie-title{font-size:16px;font-weight:bold;color:var(--accent);margin:0;}
.meta{font-size:13px;color:var(--muted);margin:4px 0;}
.card-actions{display:flex;gap:5px;flex-wrap:wrap;}
.btn{flex:1;text-align:center;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;z-index:1000;overflow-y:auto;}
.modal-content{background:var(--card-bg);max-width:900px;width:95%;max-height:90vh;overflow-y:auto;border-radius:8px;padding:20px;position:relative;}
.close{position:absolute;top:10px;right:15px;cursor:pointer;color:var(--accent);font-size:22px;}
iframe,video{width:100%;height:400px;border-radius:6px;}
#adminPanel{display:none;padding:20px;background:var(--card-bg);border-top:1px solid rgba(0,255,102,0.15);}
#adminPanel h3{color:var(--accent);margin-bottom:10px;}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;}
label{font-size:13px;color:var(--muted);margin-bottom:3px;display:block;}
.form-control{display:flex;flex-direction:column;}
textarea{resize:vertical;min-height:80px;}
.submit-row{margin-top:15px;text-align:right;}
#watchlistModal h2{color:var(--accent);margin-bottom:15px;}
#watchlistModal .movie-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;}
.watchlist-card{background:#111;border-radius:8px;padding:10px;text-align:center;transition:transform 0.2s;}
.watchlist-card:hover{transform:scale(1.05);background:#181818;}
.watchlist-card img{width:100%;border-radius:6px;margin-bottom:6px;}
.remove-btn{margin-top:6px;padding:4px 8px;border:none;border-radius:4px;background:#e63946;color:white;cursor:pointer;font-size:0.8rem;}
.remove-btn:hover{background:#c82333;}
.episode-list{margin-top:10px;}
.episode-list button{margin:2px;font-size:0.8rem;}
</style>
</head>
<body>
<header>
  <div class="logo">MovieDrift</div>
  <div class="controls">
    <input id="search" type="search" placeholder="Search movies...">
    <select id="genreFilter"><option value="">All genres</option></select>
    <select id="yearFilter"><option value="">All years</option></select>
    <button id="watchlistToggle">Watchlist (0)</button>
    <button id="adminLogin">Admin Login</button>
  </div>
</header>

<main><div id="grid" class="grid"></div></main>

<section id="adminPanel">
  <h3>➕ Add a Movie/Series</h3>
  <form id="adminForm" class="form-grid" enctype="multipart/form-data">
    <div class="form-control"><label>Title</label><input name="title" type="text" required></div>
    <div class="form-control"><label>Year</label><input name="year" type="number" required></div>
    <div class="form-control"><label>Genres (comma separated)</label><input name="genres" type="text" required></div>
    <div class="form-control"><label>Poster Image</label><input name="posterFile" type="file" accept="image/*"></div>
    <div class="form-control"><label>Poster URL (optional)</label><input name="posterURL" type="url"></div>
    <div class="form-control"><label>Movie File (MP4)</label><input name="movieFile" type="file" accept="video/mp4"></div>
    <div class="form-control"><label>Trailer/Embed Link</label><input name="trailer" type="url"></div>
    <div class="form-control"><label>Episodes (MP4, multiple)</label><input name="episodes[]" type="file" accept="video/mp4" multiple></div>
    <div class="form-control" style="grid-column: span 2;"><label>Description</label><textarea name="description" required></textarea></div>
    <div class="submit-row"><button type="submit">Add Movie/Series</button></div>
  </form>
  <h3>📋 Manage Movies</h3>
  <div id="adminMovieList"></div>
</section>

<div class="modal" id="movieModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('movieModal')">&times;</span>
    <h2 id="modalTitle"></h2>
    <p id="modalYear"></p>
    <p id="modalGenres"></p>
    <div id="modalPlayer"></div>
    <div class="episode-list" id="episodeList"></div>
    <p id="modalDesc"></p>
    <button id="modalAddToList" class="btn">➕ Add to Watchlist</button>
  </div>
</div>

<div class="modal" id="watchlistModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('watchlistModal')">&times;</span>
    <h2>📺 Your Watchlist</h2>
    <div class="movie-list" id="watchlistContainer"></div>
  </div>
</div>

<script>
let movies = [];
let watchlist = JSON.parse(localStorage.getItem("watchlist"))||[];
const grid=document.getElementById("grid");
const searchInput=document.getElementById("search");
const genreFilter=document.getElementById("genreFilter");
const yearFilter=document.getElementById("yearFilter");
const watchlistBtn=document.getElementById("watchlistToggle");

async function loadMovies(){
    const res = await fetch('movies.json');
    movies = await res.json();
    renderMovies();
    populateFilters();
    updateWatchlistCount();
}
loadMovies();

function renderMovies(){
    grid.innerHTML="";
    const searchText=searchInput.value.toLowerCase();
    const genre=genreFilter.value;
    const year=yearFilter.value;
    movies.filter(m=>{
        const matchesSearch=m.title.toLowerCase().includes(searchText)||m.description.toLowerCase().includes(searchText);
        const matchesGenre=genre?m.genres.map(g=>g.toLowerCase()).includes(genre.toLowerCase()):true;
        const matchesYear=year?m.year==year:true;
        return matchesSearch&&matchesGenre&&matchesYear;
    }).forEach((m,i)=>{
        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`
        <img class="poster" src="${m.poster}" alt="${m.title}">
        <div class="card-body">
        <h3 class="movie-title">${m.title}</h3>
        <div class="meta">${m.year} · ${m.genres.join(", ")}</div>
        <div class="card-actions">
        <button class="btn" onclick="viewDetails(${i})">Details</button>
        <button class="btn" onclick="addToWatchlist(${i})">Add to List</button>
        </div></div>`;
        grid.appendChild(card);
    });
}

// --- Filters ---
function populateFilters(){
    let allGenres=new Set();
    movies.forEach(m=>m.genres.forEach(g=>allGenres.add(g)));
    genreFilter.innerHTML='<option value="">All genres</option>';
    allGenres.forEach(g=>{const o=document.createElement("option");o.value=g;o.innerText=g;genreFilter.appendChild(o);});
    let allYears=[...new Set(movies.map(m=>m.year))].sort((a,b)=>b-a);
    yearFilter.innerHTML='<option value="">All years</option>';
    allYears.forEach(y=>{const o=document.createElement("option");o.value=y;o.innerText=y;yearFilter.appendChild(o);});
}

// --- Watchlist ---
function addToWatchlist(i){ const m=movies[i]; if(watchlist.some(w=>w.title===m.title)){alert("⚠️ Already in list!");return;} watchlist.push(m); saveWatchlist(); updateWatchlistCount(); alert(`✅ "${m.title}" added!`);}
function saveWatchlist(){ localStorage.setItem("watchlist",JSON.stringify(watchlist)); }
function updateWatchlistCount(){ watchlistBtn.textContent=`Watchlist (${watchlist.length})`; }
watchlistBtn.addEventListener("click",()=>{
    const c=document.getElementById("watchlistContainer"); c.innerHTML="";
    if(watchlist.length===0){ c.innerHTML="<p>No movies yet.</p>"; } else {
        watchlist.forEach((m,i)=>{
            const div=document.createElement("div");
            div.className="watchlist-card";
            div.innerHTML=`<img src="${m.poster}" alt="${m.title}"><h4>${m.title}</h4><p>${m.year} · ${m.genres.join(", ")}</p><button class="remove-btn" onclick="removeFromWatchlist(${i})">Remove</button>`;
            c.appendChild(div);
        });
    }
    document.getElementById("watchlistModal").style.display="flex";
});
function removeFromWatchlist(i){ watchlist.splice(i,1); saveWatchlist(); updateWatchlistCount(); watchlistBtn.click(); }

// --- Modal ---
function closeModal(id){ document.getElementById(id).style.display="none"; if(id==="movieModal") document.getElementById("modalPlayer").innerHTML=""; }
function viewDetails(i){ const m=movies[i]; document.getElementById("modalTitle").innerText=m.title; document.getElementById("modalYear").innerText="Year: "+m.year; document.getElementById("modalGenres").innerText="Genres: "+m.genres.join(", "); const player=document.getElementById("modalPlayer"); const epList=document.getElementById("episodeList"); epList.innerHTML=""; if(m.file){player.innerHTML=`<video controls src="${m.file}"></video>`;}else if(m.trailer){player.innerHTML=`<iframe src="${m.trailer}" frameborder="0" allowfullscreen></iframe>`;}else{player.innerHTML="<p>No video available</p>";} if(m.episodes && m.episodes.length>0){m.episodes.forEach((ep,idx)=>{const btn=document.createElement("button");btn.textContent="Episode "+(idx+1);btn.onclick=()=>{player.innerHTML=`<video controls src="${ep}" autoplay></video>`;};epList.appendChild(btn);});}document.getElementById("modalDesc").innerText=m.description;document.getElementById("modalAddToList").onclick=()=>addToWatchlist(i);document.getElementById("movieModal").style.display="flex";}

// --- Admin Panel ---
document.getElementById("adminLogin").addEventListener("click",()=>{const pwd=prompt("Enter admin password:");if(pwd==="@Stone001"){document.getElementById("adminPanel").style.display="block"; renderAdminMovies(); alert("✅ Admin mode activated!");} else alert("❌ Wrong password!");});

document.getElementById("adminForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const formData=new FormData(e.target);
    const res=await fetch('save_movies.php',{method:'POST',body:formData});
    const data=await res.json();
    if(data.success){movies=data.movies; renderMovies(); populateFilters(); renderAdminMovies(); e.target.reset(); alert("✅ Movie/Series added!");}
});

function renderAdminMovies(){const c=document.getElementById("adminMovieList");c.innerHTML="";if(movies.length===0){c.innerHTML="<p>No movies added yet.</p>";return;}movies.forEach((m,i)=>{const div=document.createElement("div");div.style.border="1px solid #333";div.style.padding="10px";div.style.margin="5px 0";div.style.borderRadius="6px";div.innerHTML=`<strong>${m.title}</strong> (${m.year}) - ${m.genres.join(", ")} <div style="margin-top:6px;"><button onclick="editMovie(${i})">✏️ Edit</button></div>`; c.appendChild(div);});}

function editMovie(i){const m=movies[i];document.querySelector("[name=title]").value=m.title;document.querySelector("[name=year]").value=m.year;document.querySelector("[name=genres]").value=m.genres.join(", ");document.querySelector("[name=description]").value=m.description;document.querySelector("[name=trailer]").value=m.trailer;alert("✏️ Edit the fields and submit to save changes."); movies.splice(i,1);}
searchInput.addEventListener("input",renderMovies); genreFilter.addEventListener("change",renderMovies); yearFilter.addEventListener("change",renderMovies);
</script>
</body>
</html>

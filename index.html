<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="img/logo.png" type="image/png">
<title>MovieDrift</title>
<style>
:root { --bg:#000; --card-bg:#0a0a0a; --accent:#00ff66; --text:#ddd; --muted:#888; }
body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color:var(--text);}
header { display:flex; justify-content:space-between; align-items:center; background:#111; padding:10px 20px; flex-wrap:wrap;}
.logo { font-size:24px; font-weight:bold; color:var(--accent);}
.controls { display:flex; gap:10px; flex-wrap:wrap;}
input, select, button, textarea { padding:6px 10px; border:1px solid var(--accent); border-radius:4px; background:var(--card-bg); color:var(--text);}
button { cursor:pointer; font-weight:bold;} button:hover { background:#003300;}
main { padding:20px;}
.grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap:20px;}
.card { background:var(--card-bg); border:1px solid rgba(0,255,102,0.15); border-radius:8px; overflow:hidden; display:flex; flex-direction:column; transition:transform 0.2s;}
.card:hover { transform:scale(1.05);}
.poster { width:100%; height:300px; object-fit:cover;}
.card-body { padding:10px; flex-grow:1; display:flex; flex-direction:column; justify-content:space-between;}
.movie-title { font-size:16px; font-weight:bold; color:var(--accent); margin:0;}
.meta { font-size:13px; color:var(--muted); margin:4px 0;}
.card-actions { display:flex; gap:5px; flex-wrap:wrap;}
.btn { flex:1; text-align:center;}
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000; overflow-y:auto;}
.modal-content { background:var(--card-bg); max-width:900px; width:95%; max-height:90vh; overflow-y:auto; border-radius:8px; padding:20px; position:relative;}
.close { position:absolute; top:10px; right:15px; cursor:pointer; color:var(--accent); font-size:22px;}
iframe, video { width:100%; height:400px; border-radius:6px;}
#adminPanel { display:none; padding:20px; background:var(--card-bg); border-top:1px solid rgba(0,255,102,0.15);}
#adminPanel h3 { color:var(--accent); margin-bottom:10px;}
.form-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:15px;}
label { font-size:13px; color:var(--muted); margin-bottom:3px; display:block;}
.form-control { display:flex; flex-direction:column;}
textarea { resize:vertical; min-height:80px;}
.submit-row { margin-top:15px; text-align:right;}
#watchlistModal h2 { color:var(--accent); margin-bottom:15px;}
#watchlistModal .movie-list { display:grid; grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); gap:15px;}
.watchlist-card { background:#111; border-radius:8px; padding:10px; text-align:center; transition:transform 0.2s;}
.watchlist-card:hover { transform:scale(1.05); background:#181818;}
.watchlist-card img { width:100%; border-radius:6px; margin-bottom:6px;}
.remove-btn { margin-top:6px; padding:4px 8px; border:none; border-radius:4px; background:#e63946; color:white; cursor:pointer; font-size:0.8rem;}
.remove-btn:hover { background:#c82333;}
.episode-list { margin-top:10px;}
.episode-list button { margin:2px; font-size:0.8rem;}
</style>
</head>
<body>
<header>
  <div class="logo">MovieDrift</div>
  <div class="controls">
    <input id="search" type="search" placeholder="Search movies...">
    <select id="genreFilter"><option value="">All genres</option></select>
    <select id="yearFilter"><option value="">All years</option></select>
    <button id="watchlistToggle">Watchlist (0)</button>
    <button id="adminLogin">Admin Login</button>
  </div>
</header>
<main><div id="grid" class="grid"></div></main>

<section id="adminPanel">
  <h3>➕ Add a Movie/Series</h3>
  <div class="form-grid">
    <div class="form-control"><label>Title</label><input id="movieTitle" type="text"></div>
    <div class="form-control"><label>Year</label><input id="movieYear" type="number"></div>
    <div class="form-control"><label>Genres (comma separated)</label><input id="movieGenres" type="text"></div>
    <div class="form-control"><label>Poster Image</label><input id="moviePosterFile" type="file" accept="image/*"></div>
    <div class="form-control"><label>Poster URL (optional)</label><input id="moviePosterURL" type="url"></div>
    <div class="form-control"><label>Movie File (MP4)</label><input id="movieFile" type="file" accept="video/mp4"></div>
    <div class="form-control"><label>Trailer/Embed Link (YouTube)</label><input id="movieTrailer" type="url"></div>
    <div class="form-control"><label>Episodes (MP4, select multiple)</label><input id="seriesEpisodes" type="file" accept="video/mp4" multiple></div>
    <div class="form-control" style="grid-column: span 2;">
      <label>Description</label><textarea id="movieDesc"></textarea>
    </div>
  </div>
  <div class="submit-row"><button id="addMovieBtn">Add Movie/Series</button></div>
  <h3>📋 Manage Movies</h3>
  <div id="adminMovieList"></div>
</section>

<div class="modal" id="movieModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('movieModal')">&times;</span>
    <h2 id="modalTitle"></h2>
    <p id="modalYear"></p>
    <p id="modalGenres"></p>
    <div id="modalPlayer"></div>
    <div class="episode-list" id="episodeList"></div>
    <p id="modalDesc"></p>
    <button id="modalAddToList" class="btn">➕ Add to Watchlist</button>
  </div>
</div>

<div class="modal" id="watchlistModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('watchlistModal')">&times;</span>
    <h2>📺 Your Watchlist</h2>
    <div class="movie-list" id="watchlistContainer"></div>
  </div>
</div>

<script>
// ----- Storage -----
let movies = [];
let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");
const genreFilter = document.getElementById("genreFilter");
const yearFilter = document.getElementById("yearFilter");
const watchlistBtn = document.getElementById("watchlistToggle");

// ----- Load movies.json -----
async function loadMoviesJSON(){
  try{
    const res = await fetch("movies.json");
    const data = await res.json();
    movies = data;
    localStorage.setItem("movies", JSON.stringify(movies));
    renderMovies(); populateFilters(); updateWatchlistCount();
  }catch(e){ console.error("Failed to load movies.json", e); }
}

// ----- Save to server -----
async function saveMovies(){
  localStorage.setItem("movies", JSON.stringify(movies));
  try{
    const res = await fetch("save_movies.php", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(movies)});
    const result = await res.json();
    if(result.status==="success") console.log("✅ Movies saved to server");
    else console.warn("⚠️ Server save failed:", result.message);
  }catch(e){ console.warn("⚠️ Server error:", e); }
}

// ----- Render movies -----
function renderMovies(){
  grid.innerHTML="";
  const q = searchInput.value.toLowerCase();
  movies.forEach((m,i)=>{
    if((!genreFilter.value||m.genres.includes(genreFilter.value))&&(!yearFilter.value||m.year==yearFilter.value)){
      if(m.title.toLowerCase().includes(q)){
        const card=document.createElement("div"); card.className="card";
        card.innerHTML=`<img class="poster" src="${m.poster}" alt="${m.title}"><div class="card-body">
          <p class="movie-title">${m.title}</p>
          <p class="meta">${m.year} | ${m.genres.join(", ")}</p>
          <div class="card-actions">
            <button onclick="openModal(${i})" class="btn">▶ Watch</button>
            <button onclick="addToWatchlist(${i})" class="btn">➕ Watchlist</button>
          </div></div>`;
        grid.appendChild(card);
      }
    }
  });
}

// ----- Filters -----
function populateFilters(){
  const genres = new Set(); const years = new Set();
  movies.forEach(m=>{ m.genres.forEach(g=>genres.add(g)); years.add(m.year); });
  genreFilter.innerHTML='<option value="">All genres</option>'; genres.forEach(g=>genreFilter.innerHTML+=`<option>${g}</option>`);
  yearFilter.innerHTML='<option value="">All years</option>'; Array.from(years).sort().forEach(y=>yearFilter.innerHTML+=`<option>${y}</option>`);
}

// ----- Modal -----
function openModal(i){
  const m=movies[i]; document.getElementById("modalTitle").textContent=m.title;
  document.getElementById("modalYear").textContent=m.year;
  document.getElementById("modalGenres").textContent=m.genres.join(", ");
  const playerDiv = document.getElementById("modalPlayer");
  playerDiv.innerHTML = m.fileUrl ? `<video controls src="${m.fileUrl}"></video>` :
    m.trailer ? `<iframe src="${m.trailer.replace("watch?v=","embed/")}" frameborder="0" allowfullscreen></iframe>` : "";
  const epiDiv=document.getElementById("episodeList"); epiDiv.innerHTML="";
  m.episodeIds.forEach(e=>{ epiDiv.innerHTML+=`<button onclick="alert('Play episode ${e}')">Episode</button>`; });
  document.getElementById("modalDesc").textContent=m.description;
  document.getElementById("modalAddToList").onclick=()=>{ addToWatchlist(i); closeModal("movieModal"); };
  document.getElementById("movieModal").style.display="flex";
}
function closeModal(id){ document.getElementById(id).style.display="none"; }

// ----- Watchlist -----
function addToWatchlist(i){
  if(!watchlist.includes(i)) watchlist.push(i);
  localStorage.setItem("watchlist", JSON.stringify(watchlist));
  updateWatchlistCount(); alert("Added to watchlist!");
}
function updateWatchlistCount(){ watchlistBtn.textContent=`Watchlist (${watchlist.length})`; }
watchlistBtn.addEventListener("click",()=>{
  const container=document.getElementById("watchlistContainer"); container.innerHTML="";
  watchlist.forEach(i=>{
    const m=movies[i]; const div=document.createElement("div"); div.className="watchlist-card";
    div.innerHTML=`<img src="${m.poster}" alt="${m.title}"><p>${m.title}</p><button class="remove-btn" onclick="removeFromWatchlist(${i})">Remove</button>`;
    container.appendChild(div);
  });
  document.getElementById("watchlistModal").style.display="flex";
});
function removeFromWatchlist(i){ watchlist=watchlist.filter(x=>x!==i); localStorage.setItem("watchlist",JSON.stringify(watchlist)); updateWatchlistCount(); renderMovies(); }

// ----- Filters change -----
searchInput.addEventListener("input",renderMovies);
genreFilter.addEventListener("change",renderMovies);
yearFilter.addEventListener("change",renderMovies);

// ----- Admin login toggle -----
document.getElementById("adminLogin").addEventListener("click",()=>{
  const pwd = prompt("Enter admin password:");
  if(pwd==='@Stone001'){ document.getElementById("adminPanel").style.display="block"; alert("Admin panel unlocked!"); }
  else alert("❌ Wrong password");
});

// ----- Admin Panel Functions -----
function renderAdminMovies(){
  const container=document.getElementById("adminMovieList");
  container.innerHTML="";
  if(movies.length===0){ container.innerHTML="<p>No movies added yet.</p>"; return; }
  movies.forEach((m,i)=>{
    const div=document.createElement("div"); div.style.border="1px solid #333"; div.style.padding="10px"; div.style.margin="5px 0"; div.style.borderRadius="6px";
    div.innerHTML=`<strong>${m.title}</strong> (${m.year}) 
      <button onclick="editMovie(${i})" style="margin-left:10px;">Edit</button>
      <button onclick="deleteMovie(${i})" style="margin-left:5px;">Delete</button>`;
    container.appendChild(div);
  });
}

document.getElementById("addMovieBtn").addEventListener("click", async ()=>{
  const title=document.getElementById("movieTitle").value.trim();
  const year=parseInt(document.getElementById("movieYear").value);
  const genres=document.getElementById("movieGenres").value.split(",").map(g=>g.trim()).filter(Boolean);
  const desc=document.getElementById("movieDesc").value.trim();
  const posterURL=document.getElementById("moviePosterURL").value.trim();
  const trailer=document.getElementById("movieTrailer").value.trim();
  if(!title||!year||!genres.length||(!posterURL&&!document.getElementById("moviePosterFile").files[0])||(!trailer&&!document.getElementById("movieFile").files[0])||!desc){ alert("⚠️ Fill all fields"); return; }
  const poster=posterURL; // for simplicity, skipping file upload
  movies.push({title,year,genres,poster,fileUrl:"",trailer,description:desc,episodeIds:[]});
  renderMovies(); populateFilters(); renderAdminMovies(); saveMovies();
  alert("✅ Movie added!"); document.querySelectorAll("#adminPanel input, #adminPanel textarea").forEach(e=>e.value="");
});

function deleteMovie(i){ if(confirm("Delete this movie?")){ movies.splice(i,1); renderMovies(); populateFilters(); renderAdminMovies(); saveMovies(); } }
function editMovie(i){
  const m=movies[i]; const newTitle=prompt("Edit title:",m.title); if(newTitle)m.title=newTitle;
  const newYear=prompt("Edit year:",m.year); if(newYear)m.year=parseInt(newYear);
  const newGenres=prompt("Edit genres (comma separated):",m.genres.join(",")); if(newGenres)m.genres=newGenres.split(",").map(g=>g.trim()).filter(Boolean);
  const newDesc=prompt("Edit description:",m.description); if(newDesc)m.description=newDesc;
  renderMovies(); populateFilters(); renderAdminMovies(); saveMovies();
}

// ----- Initialize -----
loadMoviesJSON(); renderAdminMovies();
</script>
</body>
</html>
